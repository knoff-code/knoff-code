# Использование LLM в 1с

---

### 1. Архитектура связки

```
1С:УНФ / ERP / УТ
     │
     │ (HTTP / REST, JSON)
     ▼
API-шлюз (обработка в 1С:HTTPЗапрос)
     │
     ▼
Python-сервис (FastAPI/Flask)
     │
     ├─ Подключение к LLM (OpenAI API, Ollama, LM-Studio, HuggingFace)
     │
     └─ Доп. агенты (pandas, sklearn для статистики, правила проверки цен)
```

---

### 2. Поток данных

1. **1С** выгружает каталог: номенклатура, характеристики, цены, поставщик.
2. **Обработка в 1С** формирует JSON:

   ```json
   {
     "item": "Кирпич красный полнотелый",
     "price": 15.5,
     "unit": "шт",
     "supplier": "ООО СтройРесурс"
   }
   ```
3. **Python-сервис** принимает данные, передаёт в LLM-агента.
4. **LLM-агент**:

   * нормализует название;
   * сопоставляет с категориями (дерево каталога);
   * проверяет цену относительно среднего по рынку/истории.
5. Результат возвращается в 1С:

   ```json
   {
     "normalized_name": "Кирпич М100 красный",
     "category": "Стройматериалы/Кирпич",
     "price_status": "ниже рынка на 30%",
     "suggested_price": 22.0
   }
   ```
6. **1С** обновляет каталог или создаёт задачу для менеджера.

---

### 3. Технологический стек

* **1С**: HTTPЗапрос, JSON (встроенные методы или библиотека «1С-JSON»).
* **API-шлюз**: Python (FastAPI ― удобнее для асинхронных запросов).
* **LLM**:

  * локально (Ollama + LLaMA2/3, Mistral, DeepSeek);
  * облако (OpenAI, Anthropic, YandexGPT).
* **Аналитика цен**: pandas + sklearn (среднее, медиана, выбросы).

---

### 4. Агентная логика

LLM-агент работает как «мозг», но у него есть помощники:

* **Rule-based фильтры**: проверка единиц измерения, НДС, валюты.
* **ML-аналитика**: выявление подозрительных цен.
* **LLM-подсказка**: нормализация названий, поиск дублей, генерация описаний.

---

### 5. Плюсы такого подхода

* LLM не «ломает» 1С, а только советует.
* Легко заменить модель или API, не трогая 1С.
* Можно масштабировать под разные каталоги и рынки.
